<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cổng Tra cứu Thông tin Gửi xe</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <!-- NÂNG CẤP: Thêm thư viện Day.js để xử lý và đồng bộ thời gian -->
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/utc.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/timezone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/duration.js"></script>

    <link rel="stylesheet" href="lookup.css"> <!-- Đảm bảo dòng này vẫn còn -->
</head>

<body>
    <div class="bg-shape-1"></div>
    <div class="bg-shape-2"></div>

    <header class="app-header">
        <div class="header-container">
            <div class="logo-wrapper">
                <img src="https://cdn.haitrieu.com/wp-content/uploads/2021/11/Logo-Doan-Thanh-NIen-Cong-San-Ho-Chi-Minh-1.png"
                    alt="Huy hiệu Đoàn" class="logo-img">
            </div>
            <div class="title-group">
                <p class="subtitle">ĐOÀN THANH NIÊN PHƯỜNG BA ĐÌNH - HÀ NỘI</p>
                <h1>Cổng Tra Cứu</h1>
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- Khu vực tìm kiếm -->
        <div id="search-section" class="card search-card">
            <h2 class="section-title">Tra cứu Thông tin Gửi xe</h2>
            <form id="plate-search-form" class="search-form" autocomplete="off">
                <div class="input-group">
                    <input type="text" id="plate-input" placeholder="Nhập biển số hoặc mã vé..." required
                        autocapitalize="characters" autocorrect="off">
                    <button type="submit" class="btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <span>Tìm kiếm</span>
                    </button>
                </div>
            </form>

            <div class="divider">
                <span>HOẶC</span>
            </div>

            <button id="scan-qr-btn" class="btn-secondary btn-full" type="button">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                    <path d="M12 22l0 .01"></path>
                    <path d="M12 12l0 .01"></path>
                </svg>
                <span>Quét mã QR vé xe</span>
            </button>
        </div>

        <!-- Khu vực hiển thị kết quả -->
        <div id="results-section" style="display: none;">
            <div class="result-header">
                <span class="label">Kết quả cho biển số</span>
                <div id="plate-display" class="plate-number"></div>
            </div>

            <div id="history-container" class="history-list">
                <!-- Lịch sử sẽ được chèn vào đây bằng JS -->
            </div>
        </div>

        <!-- Khu vực thông báo và tải -->
        <div id="message-box" style="display: none;"></div>
    </div>

    <!-- Modal xác thực số điện thoại -->
    <div id="phone-verification-modal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">Xác thực chủ xe</h3>
            <p style="text-align: center; color: var(--text-sub); margin-bottom: 1.5rem;">
                Vui lòng nhập số điện thoại đã đăng ký để xem thông tin chi tiết của xe <strong
                    id="verify-plate-number"></strong>
            </p>
            <form id="phone-verify-form">
                <div class="input-group" style="margin-bottom: 1rem;">
                    <input type="tel" id="verify-phone-input" class="input-rounded" placeholder="Nhập số điện thoại..."
                        required pattern="[0-9]{10,12}" style="text-align: center; letter-spacing: 1px;">
                </div>
                <button type="submit" class="btn-primary btn-full">Xác nhận</button>
                <button type="button" id="close-verify-btn" class="btn-secondary btn-full"
                    style="margin-top: 0.5rem;">Hủy bỏ</button>
            </form>
        </div>
    </div>

    <!-- Modal quét QR -->
    <div id="qr-scanner-modal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">Quét mã QR trên vé xe</h3>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 1rem;">Di chuyển camera để mã QR
                nằm
                trong khung hình.</p>
            <video id="camera-feed" playsinline></video>
            <button id="close-scanner-btn" class="btn-scan-qr">Đóng</button>
        </div>
    </div>

    <!-- SỬA LỖI: Nhúng tệp cấu hình để cung cấp kết nối Supabase -->
    <script src="fee_calculator.js"></script>
    <script src="config.js"></script>
    <script src="lookup.js" defer></script>
</body>

</html>